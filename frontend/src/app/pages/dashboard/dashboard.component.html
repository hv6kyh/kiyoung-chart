<div class="app-container">
    <app-header></app-header>
    <div class="main-layout">
        <app-stock-sidebar (stockSelected)="selectSymbol($event)"></app-stock-sidebar>

        <main class="chart-section">
            <!-- Analysis Mode Tabs -->
            <div class="analysis-modes">
                @for (mode of analysisModes; track mode.key) {
                    <button class="mode-tab" [class.active]="analysisMode() === mode.key"
                        (click)="setAnalysisMode(mode.key)">
                        <span class="mode-label">{{ mode.label }}</span>
                        <span class="mode-desc">{{ mode.desc }}</span>
                    </button>
                }
            </div>

            <!-- Stock Header -->
            @if (!isLoading() && predictionData()) {
                <div class="chart-header">
                    <div class="stock-title">
                        <div class="name-row">
                            <h2>{{ currentStockInfo().name }}</h2>
                            <span class="stock-code-badge">{{ currentSymbol() }}</span>
                        </div>
                        <div class="price-row">
                            <span class="current-price" [class.up]="priceChange().isUp" [class.down]="!priceChange().isUp">
                                {{ currentPrice() | number }}
                            </span>
                            <span class="price-change" [class.up]="priceChange().isUp" [class.down]="!priceChange().isUp">
                                {{ priceChange().isUp ? '▲' : '▼' }}
                                {{ priceChange().value | number }}
                                ({{ priceChange().isUp ? '+' : '-' }}{{ priceChange().percent | number:'1.2-2' }}%)
                            </span>
                        </div>
                    </div>
                </div>
            } @else {
                <div class="skeleton-header skeleton-shimmer"></div>
            }

            <!-- Chart Wrapper -->
            @if (!isLoading()) {
                <div class="chart-wrapper">
                    @if (analysisMode() !== 'BASIC') {
                        <div class="analysis-info-overlay">
                            @if (analysisMode() === 'MULTI' && multiTimeframeData()) {
                                <div class="info-pill">
                                    <span class="info-label">종합 신뢰도</span>
                                    <span class="info-grade" [class]="'grade-' + multiTimeframeData()?.confidence">
                                        {{ multiTimeframeData()?.confidence }}등급
                                    </span>
                                </div>
                            }
                            @if (analysisMode() === 'ADVANCED') {
                                <div class="info-pill">
                                    <span class="tag-sm">DTW 보정</span>
                                    <span class="tag-sm">ATR 정규화</span>
                                </div>
                            }
                        </div>
                    }
                    <app-chart [data]="predictionData()"></app-chart>
                </div>
            } @else {
                <div class="chart-wrapper skeleton-shimmer" style="min-height: 400px;">
                </div>
            }

            <!-- Disclaimer -->
            <div class="disclaimer-bar">
                <lucide-angular name="info" [size]="14"></lucide-angular>
                <span>본 분석은 과거 패턴 기반의 참고 자료이며, 실제 투자 결과를 보장하지 않습니다.</span>
            </div>
        </main>

        <app-sidebar [data]="predictionData()"></app-sidebar>
    </div>

    @if (authService.showAuthModal()) {
        <app-auth-modal></app-auth-modal>
    }
    <app-match-detail-modal></app-match-detail-modal>
</div>
