<aside class="stock-sidebar" [class.collapsed]="isCollapsed()">
    <div class="sidebar-header">
        @if (!isCollapsed()) {
            <h2>관심 종목</h2>
        }
        <button class="btn-toggle" (click)="toggleSidebar()" [title]="isCollapsed() ? '펼치기' : '접기'">
            @if (isCollapsed()) {
                <lucide-angular name="chevron-right" [size]="16"></lucide-angular>
            } @else {
                <lucide-angular name="chevron-left" [size]="16"></lucide-angular>
            }
        </button>
    </div>

    <nav class="stock-list">
        @if (isLoadingQuotes()) {
            @for (i of [1, 2, 3, 4]; track i) {
                <div class="stock-skeleton">
                    <div class="skel-avatar skeleton-shimmer"></div>
                    @if (!isCollapsed()) {
                        <div class="skel-info">
                            <div class="skel-name skeleton-shimmer"></div>
                            <div class="skel-price skeleton-shimmer"></div>
                        </div>
                    }
                </div>
            }
        } @else {
            <!-- 기본 종목 (항상 표시) -->
            @for (stock of defaultStocks(); track stock.code) {
                <div
                    class="stock-item"
                    [class.active]="selectedStock() === stock.code"
                    (click)="selectStock(stock.code)"
                >
                    <div class="stock-main">
                        <div class="stock-avatar" [style.backgroundColor]="stock.color">
                            {{ stock.shortName }}
                        </div>
                        @if (!isCollapsed()) {
                            <div class="stock-info">
                                <div class="stock-name-row">
                                    <span class="stock-name">{{ stock.name }}</span>
                                    <span class="stock-tag">{{ stock.sector }}</span>
                                </div>
                                <span class="stock-code">{{ stock.code }}</span>
                            </div>
                        }
                    </div>
                    @if (!isCollapsed()) {
                        <div class="stock-metrics">
                            <span class="price">{{ stock.price }}</span>
                            <span
                                class="change"
                                [class.up]="stock.isUp"
                                [class.down]="!stock.isUp"
                                >{{ stock.change }}</span
                            >
                        </div>
                    }
                </div>
            }

            <!-- 사용자 종목 구분선 -->
            @if (userStocksPrices().length > 0 && !isCollapsed()) {
                <div class="stock-divider">
                    <span class="divider-label">내 종목</span>
                </div>
            }

            <!-- 사용자 종목 -->
            @for (stock of userStocksPrices(); track stock.code; let i = $index) {
                <div
                    class="stock-item user-stock"
                    [class.active]="selectedStock() === stock.code"
                    (click)="selectStock(stock.code)"
                >
                    <div class="stock-main">
                        <div class="stock-avatar" [style.backgroundColor]="stock.color">
                            {{ stock.shortName }}
                        </div>
                        @if (!isCollapsed()) {
                            <div class="stock-info">
                                <div class="stock-name-row">
                                    <span class="stock-name">{{ stock.name }}</span>
                                    @if (stock.sector) {
                                        <span class="stock-tag">{{ stock.sector }}</span>
                                    }
                                </div>
                                <span class="stock-code">{{ stock.code }}</span>
                            </div>
                        }
                    </div>
                    @if (!isCollapsed()) {
                        <div class="stock-metrics">
                            <span class="price">{{ stock.price }}</span>
                            <span
                                class="change"
                                [class.up]="stock.isUp"
                                [class.down]="!stock.isUp"
                                >{{ stock.change }}</span
                            >
                        </div>
                        <button
                            class="btn-delete-stock"
                            (click)="removeUserStock($event, i)"
                            title="삭제"
                        >
                            <lucide-angular name="x" [size]="14"></lucide-angular>
                        </button>
                    }
                </div>
            }

            <!-- 모바일 종목 추가 버튼 (수평 스트립 마지막 아이템) -->
            <button class="stock-item add-stock-inline" (click)="onAddStock()">
                <div class="stock-main">
                    <div class="stock-avatar add-avatar">
                        <lucide-angular name="plus" [size]="16"></lucide-angular>
                    </div>
                </div>
            </button>
        }
    </nav>

    @if (!isCollapsed()) {
        <div class="sidebar-footer">
            <button class="btn-add" (click)="onAddStock()">
                <lucide-angular name="plus" [size]="16"></lucide-angular>
                <span>종목 추가</span>
            </button>
        </div>
    }
</aside>

<!-- 종목 추가 모달 -->
@if (showAddModal()) {
    <app-add-stock-modal (closed)="onAddModalClosed()"></app-add-stock-modal>
}
