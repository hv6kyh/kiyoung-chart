<div class="sidebar-wrapper">
    <div class="sidebar-container">
        <!-- Data Summary Card -->
        <div class="card data-summary-card">
            <h3 class="card-title">
                <lucide-angular name="activity" [size]="16"></lucide-angular>
                ÌÜµÌï© Î∂ÑÏÑù
            </h3>

            <!-- RSI Gauge -->
            <div class="metric-block">
                <div class="metric-header">
                    <span class="m-label">RSI ÏÉÅÌÉú</span>
                    <span class="m-badge" [class]="rsiStatusClass()">{{ rsiStatusDisplay() }}</span>
                </div>
                <div class="rsi-gauge">
                    <div class="gauge-track">
                        <div class="gauge-fill" [style.width.%]="rsiValue()"></div>
                        <div class="gauge-marker" [style.left.%]="rsiValue()"></div>
                    </div>
                    <div class="gauge-labels">
                        <span>Í≥ºÎß§ÎèÑ</span>
                        <span>Ï§ëÎ¶Ω</span>
                        <span>Í≥ºÎß§Ïàò</span>
                    </div>
                </div>
            </div>

            <!-- Momentum Signal -->
            <div class="metric-block">
                <div class="metric-header">
                    <span class="m-label">Î™®Î©òÌÖÄ Ïã†Ìò∏</span>
                </div>
                <div class="signal-chip" [class]="momentumChipClass()">
                    <span class="signal-dot"></span>
                    {{ momentumSignal() }}
                </div>
            </div>

            <!-- Confidence Ring -->
            <div class="metric-block confidence-block">
                <div class="metric-header">
                    <span class="m-label">Ìå®ÌÑ¥ Ïã†Î¢∞ÎèÑ</span>
                </div>
                <div class="confidence-display">
                    <div class="confidence-ring-wrap">
                        <svg class="confidence-ring" viewBox="0 0 80 80">
                            <circle class="ring-bg" cx="40" cy="40" r="34" />
                            <circle class="ring-fill" cx="40" cy="40" r="34"
                                [style.stroke-dashoffset]="confidenceOffset()" />
                        </svg>
                        <div class="confidence-text">
                            <span class="confidence-number">{{ confidenceScore() }}</span>
                            <span class="confidence-unit">%</span>
                        </div>
                    </div>
                    <span class="confidence-label">{{ confidenceLevel() }}</span>
                </div>
            </div>

            <!-- RSI Comment -->
            <div class="comment-block">
                <lucide-angular name="message-circle" [size]="14"></lucide-angular>
                <p class="comment-text">{{ rsiAnalysis()?.comment || 'Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...' }}</p>
            </div>
        </div>

        <!-- Pattern Matches Card -->
        <div class="card matches-card">
            <div class="card-header-row">
                <h3 class="card-title">Í∑ºÍ±∞ Îß§Ïπ≠</h3>
                <lucide-angular name="help-circle" [size]="14" class="info-icon"
                    title="Í≥ºÍ±∞ ÏàòÎßå Í∞úÏùò Îç∞Ïù¥ÌÑ∞ Ï§ë ÌòÑÏû¨ÏôÄ Í∞ÄÏû• Ïú†ÏÇ¨Ìïú Íµ¨Í∞ÑÎì§ÏûÖÎãàÎã§."></lucide-angular>
            </div>
            <div class="matches-list">
                @for (match of data()?.matches; track match.date; let i = $index) {
                    <div class="match-item" (click)="openProof(match)" (mouseenter)="onMatchHover($event, match)"
                        (mouseleave)="onMatchHover($event, null)">
                        <div class="match-info">
                            <span class="match-date">{{ match.date }}</span>
                            <span class="match-badge" [class.high]="match.correlation > 0.8">
                                {{ ((match.correlation * 100) | number:'1.1-1') }}%
                            </span>
                        </div>
                        <div class="match-bar-wrap">
                            <div class="match-bar">
                                <div class="match-bar-fill" [style.width.%]="match.correlation * 100"
                                    [class.high]="match.correlation > 0.8"></div>
                            </div>
                        </div>
                        <div class="match-action">
                            <span>Ï¶ùÎ™Ö Î≥¥Í∏∞</span>
                            <lucide-angular name="arrow-right" [size]="12"></lucide-angular>
                        </div>
                    </div>
                } @empty {
                    <div class="empty-msg">
                        @if (data()) {
                            <div class="empty-icon">üìä</div>
                            <p>Ïú†ÏÇ¨Ìïú Ìå®ÌÑ¥ÏùÑ Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.</p>
                            <p class="empty-sub">Îã§Î•∏ Ï¢ÖÎ™©Ïù¥ÎÇò Î∂ÑÏÑù Î™®ÎìúÎ•º ÏãúÎèÑÌï¥ Î≥¥ÏÑ∏Ïöî.</p>
                        } @else {
                            <div class="loader-dots"><span></span><span></span><span></span></div>
                            <p>Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï§ë...</p>
                        }
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Hover Tooltip -->
    @if (hoveredMatch(); as match) {
        <div class="match-tooltip" [style.top.px]="tooltipY()">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-header">
                <span class="tooltip-date">{{ match.date }}</span>
                <span class="tooltip-correlation">{{ ((match.correlation * 100) | number:'1.1-1') }}%</span>
            </div>
            <div class="tooltip-chart-wrap">
                <app-mini-chart [data]="match.windowData" [width]="280" [height]="160" [minimal]="true"></app-mini-chart>
            </div>
            <div class="tooltip-footer">
                <span class="tooltip-hint">ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÉÅÏÑ∏ Î≥¥Í∏∞</span>
            </div>
        </div>
    }
</div>
